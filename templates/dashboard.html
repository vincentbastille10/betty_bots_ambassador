{% extends "base.html" %}
{% block content %}

<div style="max-width:1040px;margin:32px auto;padding:0 1.5rem;color:#e5e7eb;">

  <!-- En-tÃªte -->
  <header style="margin-bottom:20px;">
    <p style="font-size:0.85rem;opacity:.75;margin:0 0 4px;">
      DerniÃ¨re mise Ã  jour : {{ now }}
    </p>
    <h1 style="
      font-size:clamp(1.8rem,3vw,2.4rem);
      margin:0 0 4px;
      letter-spacing:-0.03em;
    ">
      Dashboard <span style="color:#38bdf8;">Ambassadeur Betty&nbsp;Bot</span>
    </h1>
    <p style="margin:0;font-size:0.92rem;opacity:.85;">
      {{ ambassador.name }} &nbsp;â€¢&nbsp; {{ ambassador.email }}
    </p>
  </header>

  <!-- Lien Ã  partager -->
  <section style="
    margin-bottom:18px;
    padding:14px 16px;
    border-radius:14px;
    border:1px solid rgba(59,130,246,0.8);
    background:radial-gradient(circle at top left,#0ea5e944,#1e293b 60%,#020617 100%);
    font-size:0.9rem;
  ">
    <div style="display:flex;flex-wrap:wrap;align-items:center;gap:8px;margin-bottom:6px;">
      <span style="font-weight:600;">ğŸ”— Votre lien Ã  partager :</span>
      <span style="
        padding:4px 8px;
        border-radius:999px;
        border:1px solid rgba(148,163,184,0.8);
        background:rgba(15,23,42,0.95);
        font-size:0.85rem;
      ">
        ref = <strong>{{ ref }}</strong>
      </span>
    </div>
    <p style="margin:0 0 6px;word-break:break-all;">
      <a href="{{ share_link }}" target="_blank" rel="noopener"
         style="color:#93c5fd;text-decoration:underline;">
        {{ share_link }}
      </a>
    </p>
    <p style="margin:0;font-size:0.82rem;opacity:.8;">
      Utilisez ce lien dans vos emails, messages WhatsApp, posts rÃ©seaux sociaux, etc.
      Toute inscription passÃ©e par ce lien est automatiquement rattachÃ©e Ã  votre compte ambassadeur.
    </p>
  </section>

  <!-- NAV TABS -->
  <nav style="
    display:flex;
    gap:8px;
    margin-bottom:14px;
    font-size:0.9rem;
  ">
    <button type="button"
      class="tab-btn"
      data-tab="stats"
      style="
        padding:8px 14px;
        border-radius:999px;
        border:1px solid rgba(148,163,184,0.8);
        background:rgba(15,23,42,0.95);
        color:#e5e7eb;
        cursor:pointer;
      ">
      ğŸ“Š Tableau de bord
    </button>
    <button type="button"
      class="tab-btn"
      data-tab="scripts"
      style="
        padding:8px 14px;
        border-radius:999px;
        border:1px solid transparent;
        background:rgba(15,23,42,0.7);
        color:#9ca3af;
        cursor:pointer;
      ">
      ğŸ—£ï¸ Scripts pour convaincre vos clients
    </button>
  </nav>

  <!-- CONTENU : STATS -->
  <section id="tab-stats" class="tab-section" style="display:block;">

    <!-- Statistiques -->
    <div style="
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:18px;
    ">
      <div style="
        flex:1 1 140px;
        min-width:140px;
        padding:12px 14px;
        border-radius:14px;
        border:1px solid rgba(148,163,184,0.6);
        background:rgba(15,23,42,0.95);
      ">
        <div style="font-size:0.8rem;opacity:.8;">Total abonnements gÃ©nÃ©rÃ©s</div>
        <div style="font-size:1.4rem;font-weight:700;margin-top:4px;">
          {{ nb_ventes }}
        </div>
      </div>

      <div style="
        flex:1 1 140px;
        min-width:140px;
        padding:12px 14px;
        border-radius:14px;
        border:1px solid rgba(34,197,94,0.7);
        background:rgba(6,95,70,0.4);
      ">
        <div style="font-size:0.8rem;opacity:.8;">Abonnements payÃ©s</div>
        <div style="font-size:1.4rem;font-weight:700;margin-top:4px;">
          {{ nb_payees }}
        </div>
      </div>

      <div style="
        flex:1 1 140px;
        min-width:140px;
        padding:12px 14px;
        border-radius:14px;
        border:1px solid rgba(234,179,8,0.7);
        background:rgba(120,53,15,0.4);
      ">
        <div style="font-size:0.8rem;opacity:.8;">En attente de paiement</div>
        <div style="font-size:1.4rem;font-weight:700;margin-top:4px;">
          {{ nb_en_attente }}
        </div>
      </div>

      <div style="
        flex:1 1 160px;
        min-width:160px;
        padding:12px 14px;
        border-radius:14px;
        border:1px solid rgba(59,130,246,0.8);
        background:rgba(30,64,175,0.7);
      ">
        <div style="font-size:0.8rem;opacity:.8;">Total commissions versÃ©es / Ã  verser*</div>
        <div style="font-size:1.4rem;font-weight:700;margin-top:4px;">
          {{ "%.2f"|format(total) }}&nbsp;â‚¬
        </div>
      </div>
    </div>

    <p style="margin:0 0 12px;font-size:0.8rem;opacity:.7;">
      * Montant basÃ© sur les ventes marquÃ©es comme <strong>payÃ©es</strong> (colonne Â«&nbsp;PayÃ©&nbsp;Â»).
    </p>

    <!-- Tableau des ventes -->
    <div style="
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.6);
      overflow:hidden;
      background:rgba(15,23,42,0.96);
    ">
      <table style="width:100%;border-collapse:collapse;font-size:0.86rem;">
        <thead style="background:rgba(15,23,42,0.9);">
          <tr>
            <th style="padding:8px 10px;border-bottom:1px solid rgba(31,41,55,1);text-align:left;">Date</th>
            <th style="padding:8px 10px;border-bottom:1px solid rgba(31,41,55,1);text-align:left;">Client</th>
            <th style="padding:8px 10px;border-bottom:1px solid rgba(31,41,55,1);text-align:right;">Montant</th>
            <th style="padding:8px 10px;border-bottom:1px solid rgba(31,41,55,1);text-align:center;">PayÃ©</th>
          </tr>
        </thead>
        <tbody>
          {% if ventes and ventes|length > 0 %}
            {% for v in ventes %}
              <tr style="border-top:1px solid rgba(31,41,55,1);">
                <td style="padding:7px 10px;">
                  {{ v["date"] }}
                </td>
                <td style="padding:7px 10px;">
                  {{ v["customer_email"] or v["customer"] or "â€”" }}
                </td>
                <td style="padding:7px 10px;text-align:right;">
                  {{ "%.2f"|format((v["amount"] or 0) / 100) }}&nbsp;â‚¬
                </td>
                <td style="padding:7px 10px;text-align:center;">
                  {% if v["paid"] %}
                    âœ…
                  {% else %}
                    â³
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="4" style="padding:10px;text-align:center;opacity:.7;">
                Aucune vente enregistrÃ©e pour le moment. Partagez votre lien pour commencer Ã  gÃ©nÃ©rer des abonnements.
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

  </section>

  <!-- CONTENU : SCRIPTS COMMERCIAUX -->
  <section id="tab-scripts" class="tab-section" style="display:none;margin-top:8px;">

    <h2 style="font-size:1.1rem;margin:0 0 8px;">
      ğŸ—£ï¸ Scripts pour convaincre vos clients
    </h2>
    <p style="margin:0 0 14px;font-size:0.9rem;opacity:.85;">
      Voici deux scripts que vous pouvez adapter pour vos appels, vos emails ou vos messages.
      Le but est de rester simple, humain et concret.
    </p>

    <!-- Script 1 : Appel tÃ©lÃ©phonique -->
    <div style="
      margin-bottom:16px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.95);
      font-size:0.9rem;
    ">
      <div style="font-weight:600;margin-bottom:6px;">
        â˜ï¸ Script dâ€™appel tÃ©lÃ©phonique
      </div>
      <textarea readonly style="
        width:100%;
        min-height:150px;
        border-radius:10px;
        border:1px solid rgba(55,65,81,0.9);
        background:#020617;
        color:#e5e7eb;
        font-size:0.86rem;
        padding:10px;
        resize:vertical;
      ">{% raw %}Bonjour, je vous appelle parce que je me suis dit que Betty pouvait vraiment vous faire gagner du temps.

Aujourdâ€™hui, quand un visiteur arrive sur votre site en dehors de vos horaires, il fait quoi ?
La plupart du temps, soit il part, soit il va voir un concurrent.

Betty, câ€™est une assistante IA spÃ©cialisÃ©e dans votre mÃ©tier. Elle discute avec les visiteurs comme une vraie personne,
elle pose les bonnes questions (nom, email, tÃ©lÃ©phone, besoin) et vous envoie un rÃ©cap clair par email.
Comme Ã§a, vous rappelez uniquement les vrais prospects, au bon moment.

Lâ€™abonnement est Ã  79,90 â‚¬ / mois, sans engagement. 
Franchement, si Betty vous Ã©vite de perdre 1 ou 2 clients par mois, elle est rentabilisÃ©e.

Je peux vous envoyer le lien pour que vous voyiez la dÃ©mo et les infos ?
Vous pourrez activer ou non votre abonnement aprÃ¨s avoir vu comment elle travaille chez vous.{% endraw %}</textarea>
    </div>

    <!-- Script 2 : Message Ã©crit (email / WhatsApp) -->
    <div style="
      margin-bottom:16px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.95);
      font-size:0.9rem;
    ">
      <div style="font-weight:600;margin-bottom:6px;">
        ğŸ’¬ Script pour email / WhatsApp / rÃ©seaux sociaux
      </div>
      <textarea readonly style="
        width:100%;
        min-height:180px;
        border-radius:10px;
        border:1px solid rgba(55,65,81,0.9);
        background:#020617;
        color:#e5e7eb;
        font-size:0.86rem;
        padding:10px;
        resize:vertical;
      ">{% raw %}Bonjour,

Je me permets de vous Ã©crire car je pense que votre activitÃ© pourrait vraiment profiter dâ€™une assistante IA comme Betty.

Betty, câ€™est un petit chat sur votre site qui discute avec vos visiteurs quand vous nâ€™Ãªtes pas disponible :
â€“ elle accueille les personnes,
â€“ pose les bonnes questions (nom, coordonnÃ©es, besoin),
â€“ et vous envoie un rÃ©cap clair par email.

ConcrÃ¨tement : au lieu de perdre des contacts en dehors de vos horaires, Betty les rÃ©cupÃ¨re et vous les met de cÃ´tÃ©.
Vous nâ€™avez plus quâ€™Ã  les rappeler quand vous Ãªtes disponible.

Lâ€™abonnement est Ã  79,90 â‚¬ / mois, sans engagement.
Si Betty vous aide Ã  transformer ne serait-ce quâ€™1 ou 2 nouveaux clients par mois, elle sâ€™auto-finance largement.

Vous pouvez dÃ©couvrir la prÃ©sentation ici :
{{ share_link }}

Si vous voulez, je peux aussi vous expliquer en 5 minutes comment Ã§a se passe dans votre cas prÃ©cis.{% endraw %}</textarea>
    </div>

    <p style="margin:0;font-size:0.82rem;opacity:.75;">
      Nâ€™hÃ©sitez pas Ã  adapter ces scripts avec vos propres mots. Lâ€™important est de rester simple&nbsp;:
      <em>â€œBetty rÃ©pond quand vous ne pouvez pas, elle garde les prospects au chaud et vous envoie des vrais clients Ã  rappeler.â€</em>
    </p>
  </section>
</div>

<script>
  (function () {
    const tabs = document.querySelectorAll('.tab-btn');
    const sections = {
      stats: document.getElementById('tab-stats'),
      scripts: document.getElementById('tab-scripts'),
    };

    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.getAttribute('data-tab');
        Object.keys(sections).forEach(key => {
          sections[key].style.display = (key === target) ? 'block' : 'none';
        });
        tabs.forEach(b => {
          if (b === btn) {
            b.style.borderColor = 'rgba(148,163,184,0.9)';
            b.style.color = '#e5e7eb';
          } else {
            b.style.borderColor = 'transparent';
            b.style.color = '#9ca3af';
          }
        });
      });
    });
  })();
</script>

{% endblock %}
