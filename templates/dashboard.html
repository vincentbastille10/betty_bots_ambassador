{% extends "base.html" %}
{% block content %}

<div style="max-width:1040px;margin:32px auto;padding:0 1.5rem;color:#e5e7eb;">

  <!-- En-tÃªte -->
  <header style="margin-bottom:20px;">
    <p style="font-size:0.85rem;opacity:.75;margin:0 0 4px;">
      DerniÃ¨re mise Ã  jour : {{ now }}
    </p>
    <h1 style="
      font-size:clamp(1.8rem,3vw,2.4rem);
      margin:0 0 4px;
      letter-spacing:-0.03em;
    ">
      Dashboard <span style="color:#38bdf8;">Ambassadeur Betty&nbsp;Bot</span>
    </h1>
    <p style="margin:0;font-size:0.92rem;opacity:.85;">
      {{ ambassador.name }} &nbsp;â€¢&nbsp; {{ ambassador.email }}
    </p>
  </header>

  <!-- Lien Ã  partager -->
  <section style="
    margin-bottom:18px;
    padding:14px 16px;
    border-radius:14px;
    border:1px solid rgba(59,130,246,0.8);
    background:radial-gradient(circle at top left,#0ea5e944,#1e293b 60%,#020617 100%);
    font-size:0.9rem;
  ">
    <div style="display:flex;flex-wrap:wrap;align-items:center;gap:8px;margin-bottom:6px;">
      <span style="font-weight:600;">ğŸ”— Votre lien Ã  partager :</span>
      <span style="
        padding:4px 8px;
        border-radius:999px;
        border:1px solid rgba(148,163,184,0.8);
        background:rgba(15,23,42,0.95);
        font-size:0.85rem;
      ">
        ref = <strong>{{ ref }}</strong>
      </span>
    </div>
    <p style="margin:0 0 6px;word-break:break-all;">
      <a href="{{ share_link }}" target="_blank" rel="noopener"
         style="color:#93c5fd;text-decoration:underline;">
        {{ share_link }}
      </a>
    </p>
    <p style="margin:0;font-size:0.82rem;opacity:.8;">
      Utilisez ce lien dans vos emails, messages WhatsApp, posts rÃ©seaux sociaux, etc.
      Toute inscription passÃ©e par ce lien est automatiquement rattachÃ©e Ã  votre compte ambassadeur.
    </p>
  </section>

  <!-- NAV TABS -->
  <nav style="
    display:flex;
    gap:8px;
    margin-bottom:14px;
    font-size:0.9rem;
  ">
    <button type="button"
      class="tab-btn"
      data-tab="stats"
      style="
        padding:8px 14px;
        border-radius:999px;
        border:1px solid rgba(148,163,184,0.9);
        background:rgba(15,23,42,0.95);
        color:#e5e7eb;
        cursor:pointer;
      ">
      ğŸ“Š Tableau de bord
    </button>
    <button type="button"
      class="tab-btn"
      data-tab="scripts"
      style="
        padding:8px 14px;
        border-radius:999px;
        border:1px solid transparent;
        background:rgba(15,23,42,0.7);
        color:#9ca3af;
        cursor:pointer;
      ">
      ğŸ—£ï¸ Scripts & explications pour vos clients
    </button>
  </nav>

  <!-- CONTENU : STATS -->
  <section id="tab-stats" class="tab-section" style="display:block;">

    <!-- Statistiques -->
    <div style="
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:18px;
    ">
      <div style="
        flex:1 1 140px;
        min-width:140px;
        padding:12px 14px;
        border-radius:14px;
        border:1px solid rgba(148,163,184,0.6);
        background:rgba(15,23,42,0.95);
      ">
        <div style="font-size:0.8rem;opacity:.8;">Total abonnements gÃ©nÃ©rÃ©s</div>
        <div style="font-size:1.4rem;font-weight:700;margin-top:4px;">
          {{ nb_ventes }}
        </div>
      </div>

      <div style="
        flex:1 1 140px;
        min-width:140px;
        padding:12px 14px;
        border-radius:14px;
        border:1px solid rgba(34,197,94,0.7);
        background:rgba(6,95,70,0.4);
      ">
        <div style="font-size:0.8rem;opacity:.8;">Abonnements payÃ©s</div>
        <div style="font-size:1.4rem;font-weight:700;margin-top:4px;">
          {{ nb_payees }}
        </div>
      </div>

      <div style="
        flex:1 1 140px;
        min-width:140px;
        padding:12px 14px;
        border-radius:14px;
        border:1px solid rgba(234,179,8,0.7);
        background:rgba(120,53,15,0.4);
      ">
        <div style="font-size:0.8rem;opacity:.8;">En attente de paiement</div>
        <div style="font-size:1.4rem;font-weight:700;margin-top:4px;">
          {{ nb_en_attente }}
        </div>
      </div>

      <div style="
        flex:1 1 160px;
        min-width:160px;
        padding:12px 14px;
        border-radius:14px;
        border:1px solid rgba(59,130,246,0.8);
        background:rgba(30,64,175,0.7);
      ">
        <div style="font-size:0.8rem;opacity:.8;">Total commissions versÃ©es / Ã  verser*</div>
        <div style="font-size:1.4rem;font-weight:700;margin-top:4px;">
          {{ "%.2f"|format(total) }}&nbsp;â‚¬
        </div>
      </div>
    </div>

    <p style="margin:0 0 12px;font-size:0.8rem;opacity:.7;">
      * Montant basÃ© sur les ventes marquÃ©es comme <strong>payÃ©es</strong> (colonne Â«&nbsp;PayÃ©&nbsp;Â»).
    </p>

    <!-- Tableau des ventes -->
    <div style="
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.6);
      overflow:hidden;
      background:rgba(15,23,42,0.96);
    ">
      <table style="width:100%;border-collapse:collapse;font-size:0.86rem;">
        <thead style="background:rgba(15,23,42,0.9);">
          <tr>
            <th style="padding:8px 10px;border-bottom:1px solid rgba(31,41,55,1);text-align:left;">Date</th>
            <th style="padding:8px 10px;border-bottom:1px solid rgba(31,41,55,1);text-align:left;">Client</th>
            <th style="padding:8px 10px;border-bottom:1px solid rgba(31,41,55,1);text-align:right;">Montant</th>
            <th style="padding:8px 10px;border-bottom:1px solid rgba(31,41,55,1);text-align:center;">PayÃ©</th>
          </tr>
        </thead>
        <tbody>
          {% if ventes and ventes|length > 0 %}
            {% for v in ventes %}
              <tr style="border-top:1px solid rgba(31,41,55,1);">
                <td style="padding:7px 10px;">
                  {{ v["date"] }}
                </td>
                <td style="padding:7px 10px;">
                  {{ v["customer_email"] or v["customer"] or "â€”" }}
                </td>
                <td style="padding:7px 10px;text-align:right;">
                  {{ "%.2f"|format((v["amount"] or 0) / 100) }}&nbsp;â‚¬
                </td>
                <td style="padding:7px 10px;text-align:center;">
                  {% if v["paid"] %}
                    âœ…
                  {% else %}
                    â³
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="4" style="padding:10px;text-align:center;opacity:.7;">
                Aucune vente enregistrÃ©e pour le moment. Partagez votre lien pour commencer Ã  gÃ©nÃ©rer des abonnements.
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

  </section>

  <!-- CONTENU : SCRIPTS & EXPLICATIONS -->
  <section id="tab-scripts" class="tab-section" style="display:none;margin-top:8px;">

    <h2 style="font-size:1.1rem;margin:0 0 8px;">
      ğŸ—£ï¸ Scripts & explications pour vos clients
    </h2>
    <p style="margin:0 0 14px;font-size:0.9rem;opacity:.85;">
      Utilisez cette page comme boÃ®te Ã  outils&nbsp;: explication simple du parcours client + scripts prÃªts Ã  copier-coller.
    </p>

    <!-- EXPLICATION POUR LE CLIENT : PARCOURS -->
    <div style="
      margin-bottom:18px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.96);
      font-size:0.9rem;
    ">
      <div style="font-weight:600;margin-bottom:6px;">
        ğŸ‘£ Comment Ã§a se passe concrÃ¨tement pour votre client ?
      </div>
      <ol style="margin:0 0 6px 18px;padding:0;">
        <li style="margin-bottom:6px;">
          <strong>1. Inscription Ã  lâ€™abonnement Betty</strong><br>
          Votre client clique sur votre lien, arrive sur la page Betty, choisit son pack
          (ex&nbsp;: avocat, coach, artisanâ€¦) et sâ€™abonne via Stripe (79,90&nbsp;â‚¬ / mois).
        </li>
        <li style="margin-bottom:6px;">
          <strong>2. Configuration de son chatbot</strong><br>
          AprÃ¨s lâ€™abonnement, il accÃ¨de Ã  la page de configuration&nbsp;:
          couleur du bot, avatar, message dâ€™accueil, email de rÃ©ception des leads, etc.
        </li>
        <li style="margin-bottom:6px;">
          <strong>3. RÃ©ception du script dâ€™intÃ©gration par email</strong><br>
          Betty lui envoie un email avec le <strong>code du chatbot</strong>
          (un petit script JavaScript trÃ¨s court).  
          <em>Important&nbsp;:</em> il doit vÃ©rifier ses spams / courrier indÃ©sirable
          si lâ€™email nâ€™apparaÃ®t pas dans sa boÃ®te de rÃ©ception.
        </li>
        <li style="margin-bottom:6px;">
          <strong>4. IntÃ©gration du bot sur son site / sa page</strong><br>
          Le script tient en gÃ©nÃ©ral sur <strong>2 lignes</strong>.  
          Il a plusieurs options&nbsp;:
          <ul style="margin:4px 0 0 18px;padding:0;">
            <li>Le coller lui-mÃªme dans le code HTML de son site (juste avant <code>&lt;/body&gt;</code>).</li>
            <li>Lâ€™envoyer Ã  son <strong>dÃ©veloppeur / personne technique</strong> qui le mettra en place.</li>
            <li>Sur certains constructeurs (WordPress, Wix, etc.)&nbsp;:
              utiliser lâ€™option <strong>â€œajouter un widget / code HTML personnalisÃ©â€</strong>
              et coller le script dedans.
            </li>
          </ul>
        </li>
        <li>
          <strong>5. Betty commence Ã  travailler</strong><br>
          DÃ¨s que le script est en place, le chat apparaÃ®t sur son site.
          Betty accueille les visiteurs, pose les bonnes questions et
          envoie les leads par email.
        </li>
      </ol>
      <p style="margin:6px 0 0;font-size:0.8rem;opacity:.75;">
        Vous pouvez simplement expliquer Ã§a Ã  vos clients en disant&nbsp;:
        <em>â€œVous vous abonnez, vous configurez votre bot, vous recevez le code par mail
        et votre dÃ©veloppeur (ou vous-mÃªme) le colle sur le site. AprÃ¨s Ã§a, Betty travaille seule.â€</em>
      </p>
    </div>

    <!-- Script 1 : Appel tÃ©lÃ©phonique (artisans / coachs) -->
    <div style="
      margin-bottom:16px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.95);
      font-size:0.9rem;
    ">
      <div style="font-weight:600;margin-bottom:6px;">
        â˜ï¸ Script dâ€™appel tÃ©lÃ©phonique (artisans / coachs)
      </div>
      <textarea readonly style="
        width:100%;
        min-height:170px;
        border-radius:10px;
        border:1px solid rgba(55,65,81,0.9);
        background:#020617;
        color:#e5e7eb;
        font-size:0.86rem;
        padding:10px;
        resize:vertical;
      ">Bonjour, je vous appelle parce que je pense que votre activitÃ© dâ€™artisan / coach pourrait vraiment profiter dâ€™une assistante IA comme Betty.

Aujourdâ€™hui, quand quelquâ€™un arrive sur votre site ou vous Ã©crit en dehors de vos horaires, il se passe quoi ?
Souvent : la personne attend, oublieâ€¦ ou va chez un concurrent.

Betty, câ€™est une assistante IA spÃ©cialisÃ©e pour les petites structures : artisans, coachs, thÃ©rapeutes, indÃ©pendants.
Elle discute avec vos visiteurs comme une vraie personne, elle pose les bonnes questions (nom, email, tÃ©lÃ©phone, besoin),
et vous envoie un rÃ©cap clair par email.

RÃ©sultat : vous rappelez uniquement les vrais prospects, au bon moment, au lieu de passer votre temps Ã  trier des messages.

Lâ€™abonnement est Ã  79,90 â‚¬ / mois, sans engagement.
Si Betty vous aide Ã  rÃ©cupÃ©rer ne serait-ce quâ€™1 ou 2 nouveaux clients par mois, elle sâ€™auto-finance largement.

Je peux vous envoyer le lien de prÃ©sentation et la dÃ©mo pour que vous voyiez comment Ã§a fonctionne ?</textarea>
    </div>

    <!-- Script 2 : Message Ã©crit (email / WhatsApp) artisans / coachs -->
    <div style="
      margin-bottom:16px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.95);
      font-size:0.9rem;
    ">
      <div style="font-weight:600;margin-bottom:6px;">
        ğŸ’¬ Script pour email / WhatsApp / rÃ©seaux sociaux
      </div>
      <textarea readonly style="
        width:100%;
        min-height:190px;
        border-radius:10px;
        border:1px solid rgba(55,65,81,0.9);
        background:#020617;
        color:#e5e7eb;
        font-size:0.86rem;
        padding:10px;
        resize:vertical;
      ">Bonjour,

Je me permets de vous Ã©crire car je pense que votre activitÃ© dâ€™artisan / coach pourrait vraiment bÃ©nÃ©ficier dâ€™une assistante IA comme Betty.

Betty, câ€™est un petit chat sur votre site ou votre page qui discute avec vos prospects quand vous nâ€™Ãªtes pas disponible :
â€“ elle accueille les personnes,
â€“ pose les bonnes questions (nom, coordonnÃ©es, besoin),
â€“ et vous envoie un rÃ©cap clair par email.

ConcrÃ¨tement : au lieu de perdre des contacts en soirÃ©e, le week-end ou pendant vos sÃ©ances, Betty les rÃ©cupÃ¨re et vous les met de cÃ´tÃ©.
Vous nâ€™avez plus quâ€™Ã  les rappeler quand vous Ãªtes disponible.

Lâ€™abonnement est Ã  79,90 â‚¬ / mois, sans engagement.
Si Betty vous aide Ã  transformer 1 ou 2 clients de plus par mois, elle est largement rentabilisÃ©e.

Vous pouvez dÃ©couvrir la prÃ©sentation ici :
{{ share_link }}

Si vous le souhaitez, je peux aussi vous expliquer en 5 minutes comment Ã§a sâ€™appliquerait Ã  votre cas prÃ©cis (artisan, coach, thÃ©rapeuteâ€¦).</textarea>
    </div>

    <p style="margin:0;font-size:0.82rem;opacity:.75;">
      Nâ€™hÃ©sitez pas Ã  adapter ces scripts avec vos mots. Lâ€™important reste simple&nbsp;:
      <em>â€œBetty rÃ©pond quand vous ne pouvez pas, elle garde les prospects au chaud
      et vous envoie des vrais clients Ã  rappeler.â€</em>
    </p>
  </section>
</div>

<script>
  (function () {
    const tabs = document.querySelectorAll('.tab-btn');
    const sections = {
      stats: document.getElementById('tab-stats'),
      scripts: document.getElementById('tab-scripts'),
    };

    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.getAttribute('data-tab');

        Object.keys(sections).forEach(key => {
          sections[key].style.display = (key === target) ? 'block' : 'none';
        });

        tabs.forEach(b => {
          if (b === btn) {
            b.style.borderColor = 'rgba(148,163,184,0.9)';
            b.style.color = '#e5e7eb';
            b.style.background = 'rgba(15,23,42,0.95)';
          } else {
            b.style.borderColor = 'transparent';
            b.style.color = '#9ca3af';
            b.style.background = 'rgba(15,23,42,0.7)';
          }
        });
      });
    });
  })();
</script>

{% endblock %}
